// Code generated by goctl. DO NOT EDIT.
// goctl 1.9.0

package handler

import (
	"net/http"

	auth "github.com/wenpiner/last-admin-core/api/internal/handler/auth"
	base "github.com/wenpiner/last-admin-core/api/internal/handler/base"
	captcha "github.com/wenpiner/last-admin-core/api/internal/handler/captcha"
	menu "github.com/wenpiner/last-admin-core/api/internal/handler/menu"
	public_user "github.com/wenpiner/last-admin-core/api/internal/handler/public_user"
	user "github.com/wenpiner/last-admin-core/api/internal/handler/user"
	"github.com/wenpiner/last-admin-core/api/internal/svc"

	"github.com/zeromicro/go-zero/rest"
)

func RegisterHandlers(server *rest.Server, serverCtx *svc.ServiceContext) {
	server.AddRoutes(
		rest.WithMiddlewares(
			[]rest.Middleware{serverCtx.AuthMiddleware},
			[]rest.Route{
				{
					// 获取用户权限码(通过Menu获取按钮级别的权限)
					Method:  http.MethodGet,
					Path:    "/codes",
					Handler: auth.GetAccessCodesHandler(serverCtx),
				},
			}...,
		),
		rest.WithJwt(serverCtx.Config.Auth.AccessSecret),
		rest.WithPrefix("/auth"),
	)

	server.AddRoutes(
		[]rest.Route{
			{
				Method:  http.MethodGet,
				Path:    "/init",
				Handler: base.InitHandler(serverCtx),
			},
		},
	)

	server.AddRoutes(
		[]rest.Route{
			{
				// 邮箱验证码
				Method:  http.MethodPost,
				Path:    "/email",
				Handler: captcha.EmailCaptchaHandler(serverCtx),
			},
			{
				// 生成验证码
				Method:  http.MethodGet,
				Path:    "/generate",
				Handler: captcha.GenerateCaptchaHandler(serverCtx),
			},
			{
				// 发送短信验证码
				Method:  http.MethodPost,
				Path:    "/sms",
				Handler: captcha.SmsCaptchaHandler(serverCtx),
			},
		},
		rest.WithPrefix("/captcha"),
	)

	server.AddRoutes(
		rest.WithMiddlewares(
			[]rest.Middleware{serverCtx.AuthMiddleware},
			[]rest.Route{
				{
					// 获取用户角色当前所有菜单
					Method:  http.MethodGet,
					Path:    "/all",
					Handler: menu.GetAllMenusByRoleHandler(serverCtx),
				},
				{
					// 获取所有菜单
					Method:  http.MethodGet,
					Path:    "/all-menus",
					Handler: menu.GetAllMenusHandler(serverCtx),
				},
			}...,
		),
		rest.WithJwt(serverCtx.Config.Auth.AccessSecret),
		rest.WithPrefix("/menu"),
	)

	server.AddRoutes(
		[]rest.Route{
			{
				// 账号密码登录
				Method:  http.MethodPost,
				Path:    "/login",
				Handler: public_user.LoginByPasswordHandler(serverCtx),
			},
			{
				// Oauth 回调
				Method:  http.MethodGet,
				Path:    "/oauth/callback",
				Handler: public_user.OauthCallbackHandler(serverCtx),
			},
			{
				// Oauth 登录
				Method:  http.MethodPost,
				Path:    "/oauth/login",
				Handler: public_user.OauthLoginHandler(serverCtx),
			},
			{
				// 注册用户
				Method:  http.MethodPost,
				Path:    "/register",
				Handler: public_user.RegisterUserHandler(serverCtx),
			},
		},
		rest.WithPrefix("/auth"),
	)

	server.AddRoutes(
		rest.WithMiddlewares(
			[]rest.Middleware{serverCtx.AuthMiddleware},
			[]rest.Route{
				{
					// 获取用户信息
					Method:  http.MethodGet,
					Path:    "/info",
					Handler: user.GetUserInfoHandler(serverCtx),
				},
			}...,
		),
		rest.WithJwt(serverCtx.Config.Auth.AccessSecret),
		rest.WithPrefix("/user"),
	)
}
